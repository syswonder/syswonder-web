# 矽望：是什么，做什么，为什么

矽望是一个由一群系统软件爱好者自发形成的开源社区，致力于研究探索适用于未来泛在智能应用场景，特别是现场计算场景的新型操作系统关键技术。

## 现场计算场景需要新型态操作系统支撑

所谓现场计算（in-situ computing），是指在近数据源位置对数据进行实时计算，以获得对现场状况的实时感知和认知，并及时做出响应。这类应用通常运行在包含MCU、CPU、NPU、TPU、FPGA、DSP等异构多核处理器SoC的新型泛在终端硬件平台上，能够对异构、多源、多模态数据进行实时智能计算。现场计算任务复杂多样，高实时性、高可靠性任务与高算力任务混合运行，确定性计算任务和概率推算任务协同工作。此外，现场计算任务通常是专用的，要求系统具有良好的软件定义适配和动态优化能力，这些都对操作系统提出了新的挑战。

智能驾驶、智能工业、无人系统和医疗设备等领域是典型的现场计算场景。以无人系统为例，通常具备动力部和感知部两个主要部分，其中，动力部负责无人系统的运动，而感知部负责对传感数据进行现场实时处理、识别和分析。这两部分功能对操作系统的需求有明显差别：控制功能对任务的实时性和功能安全性要求较高，而感知功能对操作系统的算力调度能力和容错性要求较高。随着多核芯片性能的提升，在无人系统上传统的分域计算模式正在快速向中央计算模式发展，但使用统一的通用操作系统往往不能同时满足这两部分所涉及应用的需求。因此，需要在新型内核架构、新型安全编程语言、新型虚拟化机制、软硬协同机制、内生智能和形式化验证等方面进行交叉探索，构建新的基础软件栈，同时满足高实时性、高安全性、智能化和软件可定义的要求，并能兼容已有的Linux和RTOS应用软件生态，以支持产业发展。

## 矽望社区面向现场计算的操作系统研究

当前阶段，矽望社区的主要目标是针对近场实时感知和态势认知的现场计算场景，基于异构多处理器SoC的新型泛在终端硬件，面向实时任务和非实时任务、确定性计算任务和概率推算任务的混合工作需求，在操作系统架构、内核机制、安全保障和应用支撑等方面开展新型泛在操作系统的研究。

### 矽望社区现场计算操作系统设计理念

#### #1 面向现场计算场景的操作系统应该是专用的

现场计算场景的泛在终端硬件上部署的计算任务通常数量有限且专用，既包括实时任务也包括非实时任务。

Linux等通用操作系统的一个重要设计理念是尽可能充分地发挥硬件资源的计算能力，提升系统的吞吐量（high throughput）。为此，Linux围绕资源共享进行了诸多复杂精妙的设计，包括各种并发、同步、调度机制等。其宏内核（monolithic kernel）架构的性能突出，对对称多处理器（SMP）的支持也很好，在服务器、数据中心、网络等诸多通用计算领域占据了主导地位，尤其适合高性能计算任务。

Linux面向高吞吐量目标的设计，使其不适合运行实时（real-time）任务。实时任务要求系统行为可预测，强调保证任务时延的确定性和及时性。**PREEMPT_RT**是一套Linux内核补丁，支持实时任务，但截至2024年，**PREEMPT_RT**仍没有进入Linux内核主线。

在硬件支持方面，许多嵌入式系统硬件采用非对称异构多处理器（AMP）设计。为了支持异构多处理器，Linux提供了remoteproc和RPmsg框架，允许在远端异构处理器上运行RTOS应用。但remoteproc框架不能很好地隔离RTOS应用和其他应用，存在很大的安全隐患，不适合安全攸关场景。

各种实时操作系统（RTOS）大多是专用的，主要保证实时性，但对通用计算任务支持较差。

因此，针对现场计算这种专用计算场景，硬件主要采用非对称异构多处理器SoC，应用既有高性能计算任务也有实时任务，但任务基本固定的特点，矽望社区拟结合RTOS和Linux的优点，采用如下设计理念：

-  简化处理器管理，尽量根据需求将处理器固定分配给应用，尽量减少动态调度； 
-  简化任务管理，尽量让任务独享处理器，尽量减少并发、避免资源竞争和锁定。 

#### #2 面向现场计算场景的操作系统应该是高安全的

很多现场计算场景是安全攸关的，操作系统内核自身应该具有高安全性和可靠性。

这里的安全主要指功能安全（safety），即保证系统的功能正确性。

矽望社区拟采取两种方式来保证功能安全：

- 采用类型安全的新型Rust语言作为实现语言，相比C语言，可大大提升内存安全性。 
- 对核心代码采取形式化验证措施，保证实现代码和设计规约的一致性。 

#### #3 面向现场计算场景的操作系统应该是高智能的

很多现场计算场景执行AI概率推算任务，例如入侵检测、信号预警、模式识别、缺陷检测和故障发现等，以及复杂的现场多源多模态感知数据的态势认知计算，都需要操作系统对AI概率推算任务提供良好支持。

矽望社区未来将把AI概率推算服务作为系统核心，基于AI芯片为AI应用提供原生服务支持。

### 矽望 little.BIG 二元内核架构

基于上述应用需求和设计理念，矽望社区借鉴 separation kernel、unikernel 等设计思想，提出 **little.BIG** 二元内核架构，旨在优化异构多处理器系统中的资源管理和应用性能。在二元内核架构中：

-  **little 内核**：即硬件内核，负责管理系统的硬件资源，其设计目标是轻量、精简和高效。它像一个小的管理者，承担系统资源的分配和隔离职责，确保系统的安全和稳定。**little 内核**根据现场应用场景需求将物理资源划分到不同的分区（zone），确保各个分区在时间和空间上的独立性，从而保证应用有一个独立隔离的运行环境。分区中的资源可以是物理硬件资源，也可以是虚拟资源。在实现上，**little 内核**可以是极轻量的 Type 1 Hypervisor，运行在高优先级如 ARM 的 EL2 级。 
-  **BIG 内核**：即应用内核，专门负责应用支撑，其设计目标是强大和灵活。它像一个大的支持者，提供丰富的应用接口和高效的运行环境，满足复杂和多样化的应用需求。**BIG 内核**及其应用运行在 **little 内核**提供的分区上，独占该分区资源。**BIG 内核**及其应用称为应用体（appliance），它可以是如 RuxOS 这样的兼容 Linux 应用的一体操作系统，简化设计，支持单一应用；也可以是 Linux 操作系统支持多应用；也可以是 RTOS 等实时操作系统甚至是裸机程序，支持实时应用。 

通过 **little** 和 **BIG** 两个内核的协同工作，**little.BIG架构**能够在满足异构多处理器系统隔离性和高实时需求的同时，提供高性能和灵活的应用支持，并可以对已有Linux和RTOS生态很好兼容。

![](_media/hvisor-overview.svg)

### 当前项目

-  一个轻量化的Type 1 hypervisor [hvisor](https://github.com/syswonder/hvisor)，主要遵循[separation kernel](https://en.wikipedia.org/wiki/Separation_kernel)思想，是**little.BIG**二元内核架构中的**little**内核。hvisor 的主要功能是管理系统的物理资源，将资源组织到各个分区（zone）中，通过严格的分区确保各个分区在时间和空间上的严格隔离，从而支持各个分区的系统独立运行且互不干扰。分区里部署运行的系统称为应用体（appliance），常以轻量虚拟机方式运行。常见的应用体包括标准 Linux OS、Unikernel OS、Android OS、实时 RTOS 甚至裸机应用。通过 Type 1 hypervisor 的分区隔离，实时 RTOS 和非实时的 Linux 或 Android 虚拟机可以正常运行，满足各自的应用需求。separation kernel 常见于面向高可靠高安全（safety）应用的操作系统，如[PikeOS](https://www.sysgo.com/fileadmin/user_upload/data/professional_article_download/SYSGO_PA_2019-03_Separation_Kernel_as_a_basis_for_certifiable_applications_and_systems.pdf)。在目前的设计中，zone0 也称为根 zone（root zone），负责系统管理任务。zoneU 一般承担高算力计算任务，应用体可以是 Unikernel OS 或 Linux OS；zoneR 承担实时计算任务，应用体一般是面向 MCU 的 RTOS。 

-  一个兼容Linux应用的轻量化一体操作系统[RuxOS](https://github.com/syswonder/ruxos)，主要遵循[unikernel](https://en.wikipedia.org/wiki/Unikernel)设计思想，是**little.BIG**二元内核架构中的**BIG**内核。考虑到边缘泛在计算场景下，应用通常数量有限且相对固定，因此 RuxOS 将操作系统简化设计为只支持单应用，将内核功能封装为库，以函数调用的形式提供给应用，应用直接运行在内核态。这种库型态操作系统的应用性能将有极大提升，安全问题（security）主要由底层的 Type 1 hypervisor（hvisor）来解决。 
-  一组用 Rust 语言实现的操作系统基础构件（component），如文件系统、网络协议栈、内存管理器、消息通信机制等。基于这些构件可实现特定的库操作系统。 

底层硬件方面，将面向异构多处理器 SoC（MCU、CPU、FPGA、GPU、NPU、TPU及DSP等ASIC）新型硬件平台。前期将基于 QEMU，之后将基于物理开发板进行。

## 背景和动因

为什么我们要开展上述研究工作？原因是随着微电子、计算机、人工智能、新一代通信技术等信息技术的高速发展，人类正在进入一个人机物融合、万物智能互联的泛在计算新时代。[人机物三元融合新型计算模式](http://old2022.bulletin.cas.cn/publish_article/2022/1/20220107.htm)开始出现，信息设备数量将达万亿级（主要是各种物端设备），新型应用不断涌现，这些都对现有信息基础设施--包括芯片、操作系统、网络、计算平台等--提出了新的挑战和需求。

北京大学的研究人员将未来适应人机物三元融合新型计算模式需求的新型态操作系统称为[“泛在操作系统”](http://www.bulletin.cas.cn/thesisDetails#10.16418/j.issn.1000-3045.20211117009)，并认为由于泛在计算场景的领域行业特定性、泛在计算资源的广谱多样性和极端特异性，泛在操作系统的领域性和专用性将会比较突出，因此有必要面向不同的应用模式和场景构建不同的泛在操作系统，为此开展了[面向工业物联网场景的泛在操作系统矽璓](https://xuos.io)的研究工作。

中科院计算所的研究人员从芯片角度，提出面向广阔但多样化和碎片化应用市场场景，不走通用芯片应用之路，而是探索通过[面向领域的专门芯片进行软硬件贯通优化以获得竞争优势](http://www.bulletin.cas.cn/thesisDetails#10.16418/j.issn.1000-3045.20211117002)的设想，并认为AIoT 生态发展路径的未来也许是RISC-V/泛在OS(第5代精简指令集和泛在操作系统)的联盟。

清华大学的研究人员认为，未来新兴应用领域需要特定的新型专用操作系统。如何让开发新型操作系统像开发应用一样方便高效是一个挑战性问题。为此，他们开展了基于 Rust 语言开发各种架构/形态的操作系统内核框架和可重用内核组件的工作，探索[操作系统内核组件化定制化之路](https://github.com/chyyuu/thoughts/blob/main/tangram-oskits.md)。

在这样的背景下，我们--一些关注系统软件发展的研究人员--基于共同的兴趣建立了矽望开源社区，希望针对需要在近场进行实时感知和态势认知的现场计算场景，开展新型操作系统的探索研究与实验验证。矽望社区是一个纯粹的爱好者社区，并不属于任何一家单位。我们尝试通过这种方式，希望与国内外同样对此感兴趣的研究人员单纯就技术本身开展合作，共同探索有趣的新技术天地。

## 未来愿景

我们认为，未来是人机物融合的泛在智能计算时代，智能设备将无处不在。每台智能设备都有一个智脑，其硬件载体是智能泛在终端。正如每个人类个体都是独一无二的，每台智能设备的智脑也是与众不同的，拥有特定的硬件载体、工作场景和任务目标，因此也应拥有特定的智脑操作系统，以匹配其个性化需求。矽望社区希望未来能为智能设备提供智脑泛在操作系统，探索面向智能设备的软件定义操作系统的未来。

|            | 桌面终端      | 移动终端          | 泛在终端      |
| ---------- | ------------- | ----------------- | ------------- |
| 标志性技术 | CPU + 互联网  | 低功耗CPU + 移动网| AI芯片+ 泛在网|
| 指令集     | X86           | ARM               | RISC-V        |
| 交互方式   | GUI           | 触摸              | 多模态        |
| 计算模式   | 确定性计算    | 确定性计算        | 概率性推算    |
| 应用形态   | 算法+数据结构 | 算法+数据结构     | 模型+策略     |
| 操作系统   | Windows, Linux| iOS，Android      | 智脑UOS       |

